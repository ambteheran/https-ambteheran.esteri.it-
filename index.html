<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>داشبورد درخواست مهاجرت - ایتالیا</title>
  <style>
    body {
      margin: 0;
      font-family: "Tahoma", sans-serif;
      background-color: #f1f1f1;
    }
    header {
      background-color: #004080;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 24px;
    }
    nav {
      background-color: #e6e6e6;
      padding: 15px;
      display: flex;
      justify-content: space-around;
    }
    nav button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      background-color: #004080;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }
    nav button:disabled {
      background-color: #888;
      cursor: not-allowed;
    }
    main {
      padding: 20px;
    }
    iframe {
      width: 100%;
      height: 500px;
      border: none;
      border: 1px solid #ccc;
      margin-top: 20px;
    }
    #upload-section {
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #ccc;
      max-width: 500px;
      margin: 30px auto;
    }
    input[type="file"] {
      display: block;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>

  <header>داشبورد رسمی درخواست مهاجرت به جمهوری ایتالیا</header>

  <nav>
    <button onclick="loadResult()">نتیجه درخواست</button>
    <button onclick="document.getElementById('upload-section').style.display='block'">آپلود پاسپورت</button>
    <button disabled>نامه سی‌او</button>
    <button disabled>قرار ملاقات حضوری</button>
  </nav>

  <main>
    <iframe id="viewer" style="display: none;"></iframe>

    <div id="upload-section" style="display: none;">
      <h3>آپلود پاسپورت</h3>
      <input type="file" id="passport" accept="application/pdf" />
      <button onclick="uploadPassport()">ارسال</button>
      <p id="upload-status"></p>
    </div>
  </main>

  <script>
    // لینک خاص برای نمایش نتیجه (مثلاً صفحه تایید درخواست)
    const resultLink = "https://www.dropbox.com/scl/fi/2kr43nrhzmikj7lm3f5gd/CEU-64511169.pdf?rlkey=s7y2ct5cc3xzsnz2n2gwvr9dw&st=bva1flik&dl=0"; // ← این لینک را به لینک واقعی تغییر بده

    function loadResult() {
      const viewer = document.getElementById("viewer");
      viewer.src = resultLink;
      viewer.style.display = "block";
    }

    async function uploadPassport() {
      const fileInput = document.getElementById('passport');
      const file = fileInput.files[0];
      if (!file || file.type !== "application/pdf") {
        alert("لطفاً فقط فایل PDF انتخاب کنید.");
        return;
      }

      const reader = new FileReader();
      reader.onload = async () => {
        const base64 = reader.result.split(',')[1];

        const payload = {
          name: "کاربر", // اگر نام کاربر دارید از URL بگیر
          lastName: "موقت", 
          fileData: base64,
          fileName: file.name,
          mimeType: file.type
        };

        const response = await fetch("https://script.google.com/macros/s/AKfycbw16uY65r72N0UieELQCB7zHYfBta_jmg0xNFH7u7ITGhvqsOR7X1H6aKbp6UaRmscz7w/exec", { // ← آدرس Google Apps Script
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const result = await response.json();
        document.getElementById("upload-status").textContent = result.success ? "آپلود موفقیت‌آمیز بود." : "خطا در آپلود.";
      };
      reader.readAsDataURL(file);
    }
  </script>
</body>
</html>
